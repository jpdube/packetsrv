from app.packet.layers.ethernet import Ethernet
from app.packet.layers.fields import MacAddress


def test_pkt_with_vlan():
    packet = [
        0x00, 0x0c, 0x29, 0x24, 0xb8, 0xaf, 0xe8, 0x1c, 0xba, 0x17, 0x7d, 0x6a, 0x81, 0x00,
        0x00, 0x3d, 0x08, 0x00, 0x45, 0x00, 0x01, 0x54, 0x0e, 0x3c, 0x40, 0x00, 0x7d, 0x06,
        0x01, 0xc8, 0xc0, 0xa8, 0x67, 0x64, 0xc0, 0xa8, 0x03, 0xeb, 0xc8, 0xcf, 0x01, 0xbd,
        0x1e, 0x54, 0x73, 0xc3, 0xe4, 0x56, 0x89, 0x7c, 0x50, 0x18, 0x20, 0x35, 0x7c, 0xbf,
        0x00, 0x00,
    ]

    pkt = Ethernet(bytes(packet))

    assert(pkt.ethertype == 0x0800)
    assert(pkt.has_vlan)
    assert(pkt.vlan_id == 61)
    assert(pkt.dst_mac.to_int() == 0x000c2924b8af)


def test_pkt_no_vlan():
    packet = [
        0x00, 0x0c, 0x29, 0x24, 0xb8, 0xaf, 0xe8, 0x1c, 0xba, 0x17, 0x7d, 0x6a, 0x08, 0x00,
        0x45, 0x00, 0x01, 0x54, 0x0e, 0x3c, 0x40, 0x00, 0x7d, 0x06,
        0x01, 0xc8, 0xc0, 0xa8, 0x67, 0x64, 0xc0, 0xa8, 0x03, 0xeb, 0xc8, 0xcf, 0x01, 0xbd,
        0x1e, 0x54, 0x73, 0xc3, 0xe4, 0x56, 0x89, 0x7c, 0x50, 0x18, 0x20, 0x35, 0x7c, 0xbf,
        0x00, 0x00,
    ]

    pkt = Ethernet(bytes(packet))

    assert(pkt.ethertype == 0x0800)
    assert(not pkt.has_vlan)
    assert(pkt.dst_mac.to_int() == 0x000c2924b8af)
